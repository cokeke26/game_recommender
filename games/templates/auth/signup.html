{% extends "base.html" %}
{% block title %}Crear cuenta · GameHub{% endblock %}

{% block content %}
  <div class="mx-auto max-w-lg">
    <div class="rounded-2xl border border-white/10 bg-slate-900/40 p-6 shadow-sm">
      <div class="mb-5">
        <h1 class="text-2xl font-semibold tracking-tight">Crear cuenta</h1>
        <p class="mt-1 text-sm text-slate-400">
          Crea tu cuenta para guardar ⭐ favoritos, ❤️ me gusta y mejorar recomendaciones.
        </p>
      </div>

      {% if form.errors %}
        <div class="mb-4 rounded-xl border border-rose-400/20 bg-rose-500/10 p-3 text-sm text-rose-200">
          Revisa los campos: hay errores en el formulario.
        </div>
      {% endif %}

      <form method="post" class="space-y-4">
        {% csrf_token %}

        <div>
          <label class="mb-1 block text-xs font-medium text-slate-300">Usuario</label>
          <input
            type="text"
            name="username"
            value="{{ form.username.value|default:'' }}"
            required
            class="w-full rounded-md bg-slate-800/70 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 ring-1 ring-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500"
            placeholder="Ej: jorge_dev"
          />
          {% if form.username.errors %}
            <div class="mt-1 text-xs text-rose-200">{{ form.username.errors|striptags }}</div>
          {% endif %}
        </div>

        <div>
          <label class="mb-1 block text-xs font-medium text-slate-300">Email (opcional)</label>
          <input
            type="email"
            name="email"
            value="{{ form.email.value|default:'' }}"
            class="w-full rounded-md bg-slate-800/70 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 ring-1 ring-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500"
            placeholder="correo@ejemplo.com"
          />
          {% if form.email.errors %}
            <div class="mt-1 text-xs text-rose-200">{{ form.email.errors|striptags }}</div>
          {% endif %}
        </div>

        <!-- Password 1 -->
        <div>
          <label class="mb-1 block text-xs font-medium text-slate-300">Contraseña</label>
          <input
            id="password1"
            type="password"
            name="password1"
            required
            class="w-full rounded-md bg-slate-800/70 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 ring-1 ring-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500"
            placeholder="••••••••"
          />
          {% if form.password1.errors %}
            <div class="mt-1 text-xs text-rose-200">{{ form.password1.errors|striptags }}</div>
          {% endif %}

          <!-- Live rules -->
          <div class="mt-3 rounded-xl border border-white/10 bg-slate-950/30 p-3">
            <div class="text-xs font-semibold text-slate-300">Requisitos</div>
            <ul class="mt-2 space-y-1 text-xs">
              <li id="rule-len" class="flex items-center gap-2 text-slate-400">
                <span class="inline-flex h-4 w-4 items-center justify-center rounded bg-white/5 ring-1 ring-white/10">•</span>
                Mínimo <b>8</b> caracteres
              </li>
              <li id="rule-notnumeric" class="flex items-center gap-2 text-slate-400">
                <span class="inline-flex h-4 w-4 items-center justify-center rounded bg-white/5 ring-1 ring-white/10">•</span>
                No puede ser <b>solo números</b>
              </li>
              <li id="rule-alphanum" class="flex items-center gap-2 text-slate-400">
                <span class="inline-flex h-4 w-4 items-center justify-center rounded bg-white/5 ring-1 ring-white/10">•</span>
                Ideal: mezcla <b>letras y números</b> (más segura)
              </li>
              <li id="rule-symbol" class="flex items-center gap-2 text-slate-400">
                <span class="inline-flex h-4 w-4 items-center justify-center rounded bg-white/5 ring-1 ring-white/10">•</span>
                Ideal: incluye <b>un símbolo</b> (ej: ! @ # $)
              </li>
              <li id="rule-common" class="flex items-center gap-2 text-slate-400">
                <span class="inline-flex h-4 w-4 items-center justify-center rounded bg-white/5 ring-1 ring-white/10">•</span>
                No debe ser una contraseña <b>común</b> (se valida al enviar)
              </li>
            </ul>
          </div>
        </div>

        <!-- Password 2 -->
        <div>
          <label class="mb-1 block text-xs font-medium text-slate-300">Repite la contraseña</label>
          <input
            id="password2"
            type="password"
            name="password2"
            required
            class="w-full rounded-md bg-slate-800/70 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-400 ring-1 ring-white/10 focus:outline-none focus:ring-2 focus:ring-sky-500"
            placeholder="••••••••"
          />
          {% if form.password2.errors %}
            <div class="mt-1 text-xs text-rose-200">{{ form.password2.errors|striptags }}</div>
          {% endif %}

          <div id="matchHint" class="mt-2 text-xs text-slate-400">
            Escribe la misma contraseña.
          </div>
        </div>

        <button
          type="submit"
          class="w-full rounded-md bg-sky-600 px-4 py-2 text-sm font-semibold text-white hover:bg-sky-500"
        >
          Crear cuenta
        </button>

        <div class="flex items-center justify-between text-sm">
          <a class="text-slate-300 hover:text-white" href="{% url 'game_list' %}">← Volver</a>
          <a class="text-sky-300 hover:text-sky-200 underline underline-offset-4" href="{% url 'login' %}">
            Ya tengo cuenta
          </a>
        </div>
      </form>
    </div>
  </div>

  <script>
    const p1 = document.getElementById("password1");
    const p2 = document.getElementById("password2");

    const ruleLen = document.getElementById("rule-len");
    const ruleNotNumeric = document.getElementById("rule-notnumeric");
    const ruleAlphaNum = document.getElementById("rule-alphanum");
    const ruleSymbol = document.getElementById("rule-symbol");
    const ruleCommon = document.getElementById("rule-common");
    const matchHint = document.getElementById("matchHint");

    function setRule(el, ok) {
      // ok -> verde, else -> gris
      el.className = "flex items-center gap-2 " + (ok ? "text-emerald-300" : "text-slate-400");
      const dot = el.querySelector("span");
      if (dot) {
        dot.className =
          "inline-flex h-4 w-4 items-center justify-center rounded ring-1 " +
          (ok ? "bg-emerald-500/20 ring-emerald-400/30" : "bg-white/5 ring-white/10");
        dot.textContent = ok ? "✓" : "•";
      }
    }

    function updateRules() {
      const v = p1.value || "";

      const okLen = v.length >= 8;
      const okNotNumeric = v.length > 0 && !/^\d+$/.test(v);
      const hasLetter = /[a-zA-Z]/.test(v);
      const hasNumber = /\d/.test(v);
      const okAlphaNum = hasLetter && hasNumber;
      const okSymbol = /[^a-zA-Z0-9]/.test(v); // cualquier símbolo

      setRule(ruleLen, okLen);
      setRule(ruleNotNumeric, okNotNumeric);
      setRule(ruleAlphaNum, okAlphaNum);
      setRule(ruleSymbol, okSymbol);

      // "common" no se puede saber en frontend sin lista, lo dejamos neutral/pendiente:
      // Si el usuario ya cumple largo + no numérico, lo dejamos "casi ok" pero aclarando que se valida al enviar.
      // (si quieres lo dejamos siempre gris)
      const okCommonPreview = okLen && okNotNumeric;
      setRule(ruleCommon, okCommonPreview);
    }

    function updateMatch() {
      const a = p1.value || "";
      const b = p2.value || "";
      if (!b) {
        matchHint.className = "mt-2 text-xs text-slate-400";
        matchHint.textContent = "Escribe la misma contraseña.";
        return;
      }
      const ok = a === b;
      matchHint.className = "mt-2 text-xs " + (ok ? "text-emerald-300" : "text-rose-200");
      matchHint.textContent = ok ? "✓ Las contraseñas coinciden" : "Las contraseñas no coinciden";
    }

    p1.addEventListener("input", () => {
      updateRules();
      updateMatch();
    });
    p2.addEventListener("input", updateMatch);

    // inicial
    updateRules();
    updateMatch();
  </script>
{% endblock %}

