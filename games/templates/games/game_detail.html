{% extends "base.html" %}
{% block title %}{{ game.name }} ¬∑ GameHub{% endblock %}

{% block content %}
  <!-- Breadcrumb / back -->
  <div class="mb-4">
    <a
      href="{% url 'game_list' %}"
      class="inline-flex items-center gap-2 text-sm text-slate-300 hover:text-white"
    >
      ‚Üê Volver al cat√°logo
    </a>
  </div>

  <!-- Header card -->
  <div class="rounded-2xl border border-white/10 bg-slate-900/40 p-6">
    <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
      <div class="min-w-0">
        <h1 class="text-3xl font-semibold tracking-tight">{{ game.name }}</h1>

        <div class="mt-2 flex flex-wrap items-center gap-2 text-sm text-slate-300">
          {% if game.release_year %}
            <span class="rounded bg-white/5 px-2 py-1 ring-1 ring-white/10">{{ game.release_year }}</span>
          {% endif %}
          {% if game.rating %}
            <span class="rounded bg-white/5 px-2 py-1 ring-1 ring-white/10">‚≠ê {{ game.rating }}</span>
          {% endif %}

          <span class="text-slate-500">¬∑</span>

          <span class="text-slate-400">
            {% for p in game.platforms.all %}
              {{ p.name }}{% if not forloop.last %}, {% endif %}
            {% endfor %}
          </span>
        </div>

        {% if game.summary %}
          <p class="mt-4 max-w-3xl text-slate-200/90">
            {{ game.summary }}
          </p>
        {% else %}
          <p class="mt-4 text-slate-500">Sin descripci√≥n.</p>
        {% endif %}

        <!-- Meta chips -->
        <div class="mt-5 grid gap-3 md:grid-cols-2">
          <div class="rounded-xl border border-white/10 bg-slate-950/30 p-4">
            <div class="text-xs font-semibold text-slate-300">G√©neros</div>
            <div class="mt-2 flex flex-wrap gap-2">
              {% for g in game.genres.all %}
                <span class="rounded-md bg-white/5 px-2 py-1 text-xs text-slate-200 ring-1 ring-white/10">
                  {{ g.name }}
                </span>
              {% empty %}
                <span class="text-sm text-slate-500">Sin g√©neros.</span>
              {% endfor %}
            </div>
          </div>

          <div class="rounded-xl border border-white/10 bg-slate-950/30 p-4">
            <div class="text-xs font-semibold text-slate-300">Tags</div>
            <div class="mt-2 flex flex-wrap gap-2">
              {% for t in game.tags.all %}
                <span class="rounded-md bg-white/5 px-2 py-1 text-xs text-slate-200 ring-1 ring-white/10">
                  {{ t.name }}
                </span>
              {% empty %}
                <span class="text-sm text-slate-500">Sin tags.</span>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="shrink-0">
        <div class="rounded-2xl border border-white/10 bg-slate-950/30 p-4 lg:w-72">
          <div class="text-sm font-semibold text-slate-200">Acciones</div>
          <p class="mt-1 text-xs text-slate-400">Guarda o marca para afinar recomendaciones.</p>

          {% if user.is_authenticated %}
            <div class="mt-4 grid gap-2">
              <form method="post" action="{% url 'toggle_favorite' game.id %}">
                {% csrf_token %}
                <button
                  type="submit"
                  class="w-full rounded-md px-4 py-2 text-sm font-semibold ring-1 ring-white/10 hover:bg-white/5
                         {% if is_fav %}bg-amber-500/20 text-amber-200 ring-1 ring-amber-400/30{% else %}bg-white/5 text-slate-100{% endif %}"
                >
                  {% if is_fav %}‚≠ê Quitar de favoritos{% else %}‚òÜ Agregar a favoritos{% endif %}
                </button>
              </form>

              <form method="post" action="{% url 'toggle_like' game.id %}">
                {% csrf_token %}
                <button
                  type="submit"
                  class="w-full rounded-md px-4 py-2 text-sm font-semibold ring-1 ring-white/10 hover:bg-white/5
                         {% if is_like %}bg-rose-500/20 text-rose-200 ring-1 ring-rose-400/30{% else %}bg-white/5 text-slate-100{% endif %}"
                >
                  {% if is_like %}‚ù§Ô∏è Quitar me gusta{% else %}ü§ç Me gusta{% endif %}
                </button>
              </form>

              <div class="pt-2 text-xs text-slate-500">
                Tip: usa ‚≠ê para ‚Äúguardar‚Äù y ‚ù§Ô∏è para ‚Äúme encant√≥‚Äù.
              </div>
            </div>
          {% else %}
            <div class="mt-4 rounded-xl border border-white/10 bg-white/5 p-3">
              <p class="text-sm text-slate-200">
                Para usar ‚≠ê/‚ù§Ô∏è debes
                <a class="text-sky-300 hover:text-sky-200 underline underline-offset-4" href="{% url 'login' %}">
                  iniciar sesi√≥n
                </a>.
              </p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Similar -->
  <div class="mt-8">
    <div class="flex items-end justify-between">
      <div>
        <h2 class="text-xl font-semibold">Similares</h2>
        <p class="mt-1 text-sm text-slate-400">Basado en descripci√≥n, g√©neros, plataformas y tags.</p>
      </div>
    </div>

    <div class="mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
      {% for g in similar_games %}
        <a
          href="{% url 'game_detail' g.id %}"
          class="group rounded-xl border border-white/10 bg-slate-900/40 p-4 hover:bg-white/5"
        >
          <div class="flex items-start justify-between gap-3">
            <div class="min-w-0">
              <div class="truncate text-lg font-semibold text-slate-100 group-hover:underline">
                {{ g.name }}
              </div>
              <div class="mt-1 text-xs text-slate-400">
                {% if g.release_year %}{{ g.release_year }}{% endif %}
                {% if g.rating %} ¬∑ ‚≠ê {{ g.rating }}{% endif %}
              </div>
            </div>
            <div class="shrink-0 rounded-md bg-white/5 px-2 py-1 text-xs text-slate-300 ring-1 ring-white/10">
              Ver
            </div>
          </div>

          <div class="mt-3 text-xs text-slate-400">
            <div class="truncate">
              <span class="text-slate-300">Plataformas:</span>
              {% for p in g.platforms.all %}
                {{ p.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </div>
            <div class="mt-1 truncate">
              <span class="text-slate-300">G√©neros:</span>
              {% for gg in g.genres.all %}
                {{ gg.name }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </div>
          </div>
        </a>
      {% empty %}
        <div class="col-span-full rounded-xl border border-white/10 bg-slate-900/40 p-6">
          <p class="text-slate-300">No hay recomendaciones todav√≠a.</p>
          <p class="mt-1 text-sm text-slate-400">Prueba con otro juego o agrega m√°s datos (tags/summary).</p>
        </div>
      {% endfor %}
    </div>
  </div>
{% endblock %}

